"use strict";(self.webpackChunksc_land=self.webpackChunksc_land||[]).push([[33956],{10600:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(27106);function r(e){return function(){return new a(e.apply(this,arguments))}}function a(e){var t,i;function r(t,i){try{var s=e[t](i),o=s.value,l=o instanceof n.A;Promise.resolve(l?o.v:o).then((function(i){if(l){var n="return"===t?"return":"next";if(!o.k||i.done)return r(n,i);i=e[n](i).value}a(s.done?"return":"normal",i)}),(function(e){r("throw",e)}))}catch(e){a("throw",e)}}function a(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?r(t.key,t.arg):i=null}this._invoke=function(e,n){return new Promise((function(a,s){var o={key:e,arg:n,resolve:a,reject:s,next:null};i?i=i.next=o:(t=i=o,r(e,n))}))},"function"!=typeof e.return&&(this.return=void 0)}a.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},a.prototype.next=function(e){return this._invoke("next",e)},a.prototype.throw=function(e){return this._invoke("throw",e)},a.prototype.return=function(e){return this._invoke("return",e)}},27106:(e,t,i)=>{function n(e,t){this.v=e,this.k=t}i.d(t,{A:()=>n})},46533:(e,t,i)=>{i.d(t,{CW:()=>f,DE:()=>g,GA:()=>y,S1:()=>v,pH:()=>_});var n=i(89379),r=i(81806),a=i(76460),s=i(15941),o=i(50346),l=i(47249),u=i(76797),d=i(80963);const c=()=>a.A.getLogger("esri.views.2d.engine.flow.dataUtils"),h=10;async function f(e,t,i,n){const a=performance.now(),s=g(t,i),u=performance.now(),d=v(t,s,i.width,i.height),f=performance.now(),m=function(e,t){const i=new l.A,n=e.reduce(((e,t)=>e+t.vertices.length),0),r=new Float32Array(4*n),a=new Array(e.length);let s=0,o=0;for(const{vertices:l}of e){const e=s;for(const t of l)r[4*s]=t.x,r[4*s+1]=t.y,r[4*s+2]=t.t,r[4*s+3]=t.speed,s++;a[o++]={startVertex:e,numberOfVertices:l.length,totalTime:l[l.length-1].t,timeSeed:t?i.getFloat():0}}return{lineVertices:r,lineDescriptors:a}}(d,!0),p=performance.now(),y="Streamlines"===e?function(e,t){const i=9,{lineVertices:n,lineDescriptors:r}=e;let a=0,s=0;for(const f of r)a+=2*f.numberOfVertices,s+=6*(f.numberOfVertices-1);const o=new Float32Array(a*i),l=new Uint32Array(s);let u=0,d=0;function c(){l[d++]=u-2,l[d++]=u,l[d++]=u-1,l[d++]=u,l[d++]=u+1,l[d++]=u-1}function h(e,t,n,r,a,s,l,d){const c=u*i;let h=0;o[c+h++]=e,o[c+h++]=t,o[c+h++]=1,o[c+h++]=n,o[c+h++]=s,o[c+h++]=l,o[c+h++]=r/2,o[c+h++]=a/2,o[c+h++]=d,u++,o[c+h++]=e,o[c+h++]=t,o[c+h++]=-1,o[c+h++]=n,o[c+h++]=s,o[c+h++]=l,o[c+h++]=-r/2,o[c+h++]=-a/2,o[c+h++]=d,u++}for(const f of r){const{totalTime:e,timeSeed:i}=f;let r=null,a=null,s=null,o=null,l=null,u=null;for(let d=0;d<f.numberOfVertices;d++){const g=n[4*(f.startVertex+d)],m=n[4*(f.startVertex+d)+1],p=n[4*(f.startVertex+d)+2],v=n[4*(f.startVertex+d)+3];let y=null,_=null,w=null,T=null;if(d>0){y=g-r,_=m-a;const n=Math.sqrt(y*y+_*_);if(y/=n,_/=n,d>1){let e=y+l,i=_+u;const n=Math.sqrt(e*e+i*i);e/=n,i/=n;const r=Math.min(1/(e*y+i*_),t);e*=r,i*=r,w=-i,T=e}else w=-_,T=y;null!==w&&null!==T&&(h(r,a,s,w,T,e,i,v),c())}r=g,a=m,s=p,l=y,u=_,o=v}h(r,a,s,-u,l,e,i,o)}return{vertexData:o,indexData:l}}(m,h):function(e){const t=16,i=1,n=2,{lineVertices:r,lineDescriptors:a}=e;let s=0,o=0;for(const k of a){const e=k.numberOfVertices-1;s+=4*e*2,o+=6*e*2}const l=new Float32Array(s*t),u=new Uint32Array(o);let d,c,h,f,g,m,p,v,y,_,w,T,M,x,S=0,b=0;function A(){u[b++]=S-8,u[b++]=S-7,u[b++]=S-6,u[b++]=S-7,u[b++]=S-5,u[b++]=S-6,u[b++]=S-4,u[b++]=S-3,u[b++]=S-2,u[b++]=S-3,u[b++]=S-1,u[b++]=S-2}function R(e,r,a,s,o,u,d,c,h,f,g,m,p,v){const y=S*t;let _=0;for(const t of[i,n])for(const i of[1,2,3,4])l[y+_++]=e,l[y+_++]=r,l[y+_++]=a,l[y+_++]=s,l[y+_++]=d,l[y+_++]=c,l[y+_++]=h,l[y+_++]=f,l[y+_++]=t,l[y+_++]=i,l[y+_++]=p,l[y+_++]=v,l[y+_++]=o/2,l[y+_++]=u/2,l[y+_++]=g/2,l[y+_++]=m/2,S++}function C(e,t){let i=y+w,n=_+T;const r=Math.sqrt(i*i+n*n);i/=r,n/=r;const a=y*i+_*n;i/=a,n/=a;let s=w+M,o=T+x;const l=Math.sqrt(s*s+o*o);s/=l,o/=l;const u=w*s+T*o;s/=u,o/=u,R(d,c,h,f,-n,i,g,m,p,v,-o,s,e,t),A()}function V(e,t,i,n,r,a){if(y=w,_=T,w=M,T=x,null==y&&null==_&&(y=w,_=T),null!=g&&null!=m){M=e-g,x=t-m;const i=Math.sqrt(M*M+x*x);M/=i,x/=i}null!=y&&null!=_&&C(r,a),d=g,c=m,h=p,f=v,g=e,m=t,p=i,v=n}function P(e,t){y=w,_=T,w=M,T=x,null==y&&null==_&&(y=w,_=T),null!=y&&null!=_&&C(e,t)}for(const k of a){d=null,c=null,h=null,f=null,g=null,m=null,p=null,v=null,y=null,_=null,w=null,T=null,M=null,x=null;const{totalTime:e,timeSeed:t}=k;for(let i=0;i<k.numberOfVertices;i++)V(r[4*(k.startVertex+i)],r[4*(k.startVertex+i)+1],r[4*(k.startVertex+i)+2],r[4*(k.startVertex+i)+3],e,t);P(e,t)}return{vertexData:l,indexData:u}}(m),_=performance.now();return(0,r.A)("esri-2d-profiler")&&(c().info("I.1","_createFlowFieldFromData (ms)",Math.round(u-a)),c().info("I.2","_getStreamlines (ms)",Math.round(f-u)),c().info("I.3","createAnimatedLinesData (ms)",Math.round(p-f)),c().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(_-p)),c().info("I.5","createFlowMesh (ms)",Math.round(_-a)),c().info("I.6","Mesh size (bytes)",y.vertexData.buffer.byteLength+y.indexData.buffer.byteLength)),await Promise.resolve(),(0,o.Te)(n),y}function g(e,t){const i=function(e,t,i,n){if(0===n)return e;const r=Math.round(3*n),a=new Array(2*r+1);let s=0;for(let u=-r;u<=r;u++){const e=Math.exp(-u*u/(n*n));a[u+r]=e,s+=e}for(let u=-r;u<=r;u++)a[u+r]/=s;const o=new Float32Array(e.length);for(let u=0;u<i;u++)for(let i=0;i<t;i++){let n=0,s=0;for(let o=-r;o<=r;o++){if(i+o<0||i+o>=t)continue;const l=a[o+r];n+=l*e[2*(u*t+(i+o))],s+=l*e[2*(u*t+(i+o))+1]}o[2*(u*t+i)]=n,o[2*(u*t+i)+1]=s}const l=new Float32Array(e.length);for(let u=0;u<t;u++)for(let e=0;e<i;e++){let n=0,s=0;for(let l=-r;l<=r;l++){if(e+l<0||e+l>=i)continue;const d=a[l+r];n+=d*o[2*((e+l)*t+u)],s+=d*o[2*((e+l)*t+u)+1]}l[2*(e*t+u)]=n,l[2*(e*t+u)+1]=s}return l}(t.data,t.width,t.height,e.smoothing);return e.interpolate?(e,n)=>{const r=Math.floor(e),a=Math.floor(n);if(r<0||r>=t.width)return[0,0];if(a<0||a>=t.height)return[0,0];const s=e-r,o=n-a,l=r,u=a,d=r<t.width-1?r+1:r,c=a<t.height-1?a+1:a,h=i[2*(u*t.width+l)],f=i[2*(u*t.width+d)],g=i[2*(c*t.width+l)],m=i[2*(c*t.width+d)],p=i[2*(u*t.width+l)+1],v=i[2*(u*t.width+d)+1];return[(h*(1-o)+g*o)*(1-s)+(f*(1-o)+m*o)*s,(p*(1-o)+i[2*(c*t.width+l)+1]*o)*(1-s)+(v*(1-o)+i[2*(c*t.width+d)+1]*o)*s]}:(e,n)=>{const r=Math.round(e),a=Math.round(n);return r<0||r>=t.width||a<0||a>=t.height?[0,0]:[i[2*(a*t.width+r)],i[2*(a*t.width+r)+1]]}}function m(e,t,i,n,r,a,o,l){const u=[],{raster:d,width:c,height:h,resolutionFactor:f}=l;let g=n,m=r,p=0,[v,y]=i(g,m);v*=t.velocityScale,y*=t.velocityScale;const _=Math.sqrt(v*v+y*y);let w,T;u.push({x:g,y:m,t:p,speed:_});for(let M=0;M<t.verticesPerLine;M++){let[n,r]=i(g,m);n*=t.velocityScale,r*=t.velocityScale;const l=Math.sqrt(n*n+r*r);if(l<t.minSpeedThreshold)return u;const v=e*n/l,y=e*r/l;if(g+=v*t.segmentLength,m+=y*t.segmentLength,t.wrapAround&&(g=(0,s.OS)(g,a[0])),p+=e*t.segmentLength/l,Math.acos(v*w+y*T)>t.maxTurnAngle)return u;if(t.collisions){let e=Math.round(g*f);const i=Math.round(m*f);if(t.wrapAround&&(e=(0,s.OS)(e,c)),e<0||e>c-1||i<0||i>h-1)return u;const n=d[i*c+e];if(-1!==n&&n!==o)return u;d[i*c+e]=o}u.push({x:g,y:m,t:p,speed:l}),w=v,T=y}return u}function p(e,t,i,r,a,s,o,l){const u=Math.round((.2+.6*o.getFloat())*e.verticesPerLine),d=e.verticesPerLine-u,c=m(-1,(0,n.A)((0,n.A)({},e),{},{verticesPerLine:d}),t,i,r,a,s,l),h=m(1,(0,n.A)((0,n.A)({},e),{},{verticesPerLine:u}),t,i,r,a,s,l),f=c.reverse();return f.splice(-1,1),f.concat(h)}function v(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{positions:[]};if(e.density<=0)return[];const{positions:a}=r,s=[],o=new l.A,u=1/Math.max(e.lineCollisionWidth,1),d=Math.round(i*u),c=Math.round(n*u),h=new Int32Array(d*c);for(let l=0;l<h.length;l++)h[l]=-1;const f={raster:h,width:d,height:c,resolutionFactor:u},g={},v=e.lineSpacing/Math.sqrt(e.density),y=Math.floor(n/v),_=Math.floor(i/v);for(let l=0;l<y;l++){const e=l*v;for(let t=0;t<_;t++){const i=t*v;g["".concat(t,"-").concat(l)]={x:i,y:e,positions:[]}}}for(const{x:l,y:m}of a){const e=g["".concat(Math.floor(l/v),"-").concat(Math.floor(m/v))];e&&e.positions.push([l,m])}const w=[];for(const l in g){const e=g[l];if(0===e.positions.length)w.push({x:e.x+v/2,y:e.y+v/2,sort:.66+.33*o.getFloat(),stage:0});else{const[t]=e.positions.splice(0,1);w.push({x:t[0],y:t[1],sort:.33*o.getFloat(),stage:1});for(const[i,n]of e.positions)w.push({x:i,y:n,sort:.33+.33*o.getFloat(),stage:2})}}w.sort(((e,t)=>e.sort-t.sort));for(const{x:l,y:T,stage:M}of w){const r=e.onlyForwardTracing?m(1,e,t,l,T,[i,n],s.length,f):p(e,t,l,T,[i,n],s.length,o,f);r.length<2||s.push({stage:M,vertices:r})}return s}function y(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.width,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.height,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=t.pixels,l=i*n,u=new Float32Array(2*l),d=t.width,c=(e,t)=>e+r+(t+a)*d,h=(e,t)=>e+t*i;let f;if(null!=t.mask)if(i!==t.width||n!==t.height||0!==r||0!==a){f=new Uint8Array(2*l);const e=t.mask;for(let t=0;t<n;++t)for(let n=0;n<i;++n){const i=c(n,t),r=h(n,t);f[2*r]=e[2*i],f[2*r+1]=e[2*i+1]}}else f=t.mask;else f=new Uint8Array(2*l),f.fill(255);if("vector-uv"===e)for(let s=0;s<n;++s)for(let e=0;e<i;++e){const t=c(e,s),i=h(e,s);u[2*i]=o[0][t],u[2*i+1]=-o[1][t]}else if("vector-magdir"===e){const{cos:e,sin:t}=Math;for(let r=0;r<n;++r)for(let n=0;n<i;++n){const i=c(n,r),a=h(n,r),l=o[0][i],d=(0,s.kU)(o[1][i]),f=e(d-Math.PI/2),g=t(d-Math.PI/2);u[2*a]=f*l,u[2*a+1]=g*l}}return{data:u,mask:f,width:i,height:n}}async function _(e,t,i,n,a,s){const o=performance.now(),l=(0,d.Vp)(t.spatialReference);if(!l){const l=await w(e,t,i,n,a,s);return(0,r.A)("esri-2d-profiler")&&c().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-o)),(0,r.A)("esri-2d-profiler")&&c().info("I.9","Number of parts",1),l}const[h,f]=l.valid,g=f-h,m=Math.ceil(t.width/g),p=t.width/m,v=Math.round(i/m);let y=t.xmin;const _=[],T=performance.now();for(let r=0;r<m;r++){const i=new u.A({xmin:y,xmax:y+p,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference});_.push(w(e,i,v,n,a,s)),y+=p}const M=await Promise.all(_);if((0,r.A)("esri-2d-profiler")&&c().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-T)),(0,r.A)("esri-2d-profiler")&&c().info("I.9","Number of parts",M.length),1===M.length)return(0,r.A)("esri-2d-profiler")&&c().info("I.10","loadImagery, general exit without stitching back (ms)",Math.round(performance.now()-o)),M[0];const x={data:new Float32Array(i*n*2),mask:new Uint8Array(i*n),width:i,height:n};let S=0;for(const r of M){for(let e=0;e<r.height;e++)for(let t=0;t<r.width;t++)S+t>=i||(x.data[2*(e*i+S+t)]=r.data[2*(e*r.width+t)],x.data[2*(e*i+S+t)+1]=r.data[2*(e*r.width+t)+1],x.mask[e*i+S+t]=r.mask[e*r.width+t]);S+=r.width}return(0,r.A)("esri-2d-profiler")&&c().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-o)),x}async function w(e,t,i,n,r,a){const s={requestProjectedLocalDirections:!0,signal:a};if(null!=r&&(s.timeExtent=r),"imagery"===e.type){var o;await e.load({signal:a});const r=await e.internalFetchImage(t,i,n,s);return null==(null===r||void 0===r||null===(o=r.pixelData)||void 0===o?void 0:o.pixelBlock)?{data:new Float32Array(i*n*2),mask:new Uint8Array(i*n),width:i,height:n}:y(e.rasterInfo.dataType,r.pixelData.pixelBlock)}await e.load({signal:a});const l=await e.fetchPixels(t,i,n,s);return null==(null===l||void 0===l?void 0:l.pixelBlock)?{data:new Float32Array(i*n*2),mask:new Uint8Array(i*n),width:i,height:n}:y(e.serviceRasterInfo.dataType,l.pixelBlock)}},51939:(e,t,i)=>{i.d(t,{AL:()=>y,DV:()=>m,ER:()=>r,F_:()=>o,Nd:()=>f,Oo:()=>a,dy:()=>h,eS:()=>M,h4:()=>x,jC:()=>v,nq:()=>g,rZ:()=>c,y6:()=>p});var n=i(44135);const r="Raster.",a="Raster.Dim.",s=".Max",o={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},l=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function u(e,t){return new n.A({name:e,alias:t,domain:null,editable:!1,length:50,type:"string"})}function d(e,t){return new n.A({name:e,alias:t,domain:null,editable:!1,type:"double"})}function c(e){return u(o.servicePixelValue,null!==e&&void 0!==e?e:"Service Pixel Value")}function h(e){return u(o.rawServicePixelValue,null!==e&&void 0!==e?e:"Raw Service Pixel Value")}function f(){return u(o.itemPixelValue,"Item Pixel Value")}function g(e){return u("".concat(o.servicePixelValue,".").concat(e),e)}function m(e){return d("".concat(o.magnitude),"Magnitude"+(e?" (".concat(e,")"):""))}function p(){return d("".concat(o.direction),"Direction (\xb0)")}function v(e){return e.fields.filter((e=>"oid"!==e.type&&"value"!==e.name.toLowerCase())).map((e=>{const t=e.clone();return t.name="".concat(r).concat(e.name),t}))}function y(e){const t=new Set,i=new Set,r=new Map;return e.variables.forEach((e=>{let{dimensions:n}=e;n.forEach((e=>{if(e.recurring)r.set(e.name,e.unit);else{var n,a;const r="ISO8601"===(null===(n=e.unit)||void 0===n?void 0:n.trim())||"stdtime"===(null===(a=e.name)||void 0===a||null===(a=a.trim())||void 0===a?void 0:a.toLowerCase())?t:i;r.add(e.name),e.hasRanges&&r.add("".concat(e.name).concat(s))}}))})),[u(o.variable,"Variable"),...[...t].map((e=>function(e,t){return new n.A({name:e,alias:t,domain:null,editable:!1,type:"date"})}("".concat(a).concat(e),w(e)))),...[...i].map((e=>d("".concat(a).concat(e),w(e)))),...[...r].map((e=>{let[t,i]=e;return d("".concat(a).concat(t),_(t,i))}))]}function _(e,t){var i;return(t=null===(i=t)||void 0===i?void 0:i.toLowerCase())&&l.has(t)?l.get(t):w(e)}function w(e){const t=e.endsWith(s),i=t?e.slice(0,-4):e,n="StdTime"===i?"Standard Time":"StdZ"===i?"Standard Z":i;return t?"".concat(n," Max"):n}function T(e,t){return t?new Date(e):e}function M(e,t,i){(null===i||void 0===i?void 0:i.length)&&(t[o.variable]=i[0].variableName,i.forEach((i=>{let{dimensionName:n,values:r}=i;if(n&&null!==r&&void 0!==r&&r.length){const i="".concat(a).concat(n),o=e.find((e=>{let{name:t}=e;return t===i}));if(!o)return;const l="date"===o.type,u=r[0];if(Array.isArray(u)){if(t["".concat(a).concat(n)]=T(u[0],l),null!=u[1]){const i="".concat(a).concat(n).concat(s);if(e.some((e=>{let{name:t}=e;return t===i}))){const e=T(u[1],l);t[i]=e}}}else t["".concat(a).concat(n)]=T(u,l)}})))}function x(e,t){if(t.pixelType.startsWith("f")&&e.forEach((e=>{let{format:t,fieldName:i}=e;t&&i&&/^raster\.(item|service)pixelvalue/i.test(i)&&(t.places=2)})),t.multidimensionalInfo){const i=t.multidimensionalInfo.variables.flatMap((e=>{let{dimensions:t}=e;return t}));e.forEach((e=>{let{format:t,fieldName:n}=e;if(t&&null!==n&&void 0!==n&&n.startsWith(a)){var r;const e=n.slice(a.length),o="".concat(e).concat(s),l=i.find((t=>{let{name:i}=t;return i===e||i===o}));(null===l||void 0===l||null===(r=l.values)||void 0===r?void 0:r.every((e=>Number.isInteger(e))))&&(t.places=0)}}))}}},64147:(e,t,i)=>{i.d(t,{$7:()=>u,Ci:()=>g,Cq:()=>m,FO:()=>d,NK:()=>h,S$:()=>n,iM:()=>f,jt:()=>a,nD:()=>l,q6:()=>s,q7:()=>o,ti:()=>c,um:()=>r});const n=.1,r=1,a=1,s=1e3,o=!1,l=3,u=1,d=1.5,c=501,h=256,f=3,g=2,m=2},89214:(e,t,i)=>{i.d(t,{A:()=>Y});var n=i(89379),r=i(6326),a=i(18690),s=(i(81806),i(30726)),o=i(50346),l=i(68134),u=i(52394),d=i(91417),c=i(31633),h=i(46053),f=(i(76460),i(87990)),g=i(34111),m=i(56611),p=i(2413),v=i(80963),y=i(731),_=i(66917),w=i(69576),T=i(1873),M=i(64147),x=i(3109),S=i(12016);class b extends S.B{constructor(e){super("FlowWorker","generateStreamlines",{generateStreamlines:e=>[e.flowData.data.buffer,e.flowData.mask.buffer],generateTiledStreamlines:e=>{const t=[];return e.flowDataTiles.forEach((e=>{"loaded"===e.type&&t.push(e.data.data.buffer,e.data.mask.buffer)})),t}},e,{strategy:"dedicated"})}generateStreamlines(e,t){return this.invokeMethod("generateStreamlines",e,t)}generateTiledStreamlines(e,t){return this.invokeMethod("generateTiledStreamlines",e,t)}}var A=i(69539),R=i(9392),C=i(75002),V=i(94587),P=i(12482),k=i(63048),L=i(70667),I=i(31723),D=i(1599);function F(e,t,i,n,r,a){let{vertices:s,stage:o,hasMagnitude:l}=i;const{spatialReference:u}=t.extent,d=[],c=(0,I.uu)(l),h=t.flowExtentInfo.modelSize[0];let f=0;for(let x=0;x<s.length;x+=c){if(a&&x>0){const e=s[x]-s[x-c];e>h/2?f-=h:-e>h/2&&(f+=h)}const[i,r]=t.modelToMapSpace(s[x]+f,s[x+1],!1),o=a?[i,r,D.bi]:q(i,r,u,e,n);d.push(o)}const g=Math.floor(s.length/c),m=(0,V.fY)(g);for(let x=0;x<g;x++)m[x]=s[x*c+2];const{hasVVColor:p,hasVVOpacity:v,hasVVSize:y}=r.parameters;let _,w,T;if(l&&(p||v||y)){const e=(0,C.oe)(g);for(let t=0;t<g;t++)e[t]=s[t*c+3];p&&(_=[e]),v&&(w=[e]),y&&(T=[e])}const M=(0,L.yU)([d],void 0,[{timeStamps:m,streamlineType:o}],_,w,T);return(0,L.te)(r,M[0])}function q(e,t,i,n,r){const{absoluteZ:a}=(0,P.Q5)(e,t,0,i,n,r),s=(0,R.fA)(e,t,a);return n.renderCoordsHelper.toRenderCoords(s,i,s),s}var Z=i(10600),E=i(48989),O=i(97255);class G{constructor(e,t,i,n,r){this._query=e,this.streamlines=t,this._material=i,this.geometries=n,this._bytesPerFeature=r,this._startTime=0,this._endTime=1/0,this.usedMemory=null,this.startTime=this._query.time,this.computeMemory()}computeMemory(){const e=(0,O.Qh)(this.streamlines),t=(0,O.Qh)(this.geometries.map((e=>e.attributes))),i=this.streamlines.length*this._bytesPerFeature;this.usedMemory=e+t+i}get startTime(){return this._startTime}set startTime(e){this._query.time!==e&&(this._query=new x.y6(this._query.extent,this._query.timeExtent,this._query.size,this._query.pixelRatio,(0,d.Kp)(e))),this._startTime=e,this.setMaterialParameters({startTime:e})}get endTime(){return this._endTime}set endTime(e){this._endTime=e,this.setMaterialParameters({endTime:e})}get query(){return this._query}hasFadedOut(e){return this.endTime+this._material.parameters.fadeOutTime<e}setMaterialParameters(e){this._material.setParameters(e)}get test(){return null}}var W=i(442),U=i(59752);class B extends G{constructor(e,t,i,n,r){super(e,t,i,n,E.Fq.LINE_ROUND.draped.bytesPerFeature),this._layerView=r,this._drapeRenderer=null,this.drapeSourceType=2,this.updatePolicy=0,this.renderGroup=0,this._frameTask=null,this._renderGeometries=[]}get _view(){return this._layerView.view}get layer(){return this._layerView.layer}get fullOpacity(){return this._layerView.fullOpacity}get attached(){return null!=this._drapeRenderer}get destroyed(){return this.attached}async attach(){const{geometries:e}=this;null!=e&&(this.detach(),this._frameTask=this._view.resourceController.scheduler.registerTask(U.W6.FLOW_GENERATOR),await this._frameTask.scheduleGenerator((t=>this._addGeometryToOverlay(e,t))))}_addGeometryToOverlay(e,t){var i=this;return(0,Z.A)((function*(){i._drapeRenderer=i._view.overlayManager.registerGeometryDrapeSource(i);for(let n=0;n<e.length;n+=M.ti){const r=e.slice(n,n+M.ti).map((e=>new W.$(e)));i._drapeRenderer.addGeometries(r,0),i._renderGeometries.push(...r),i._drapeRenderer.commitChanges(),t.madeProgress(),t.done&&(t=yield)}}))()}detach(){this._frameTask=(0,s.xt)(this._frameTask),this._drapeRenderer&&(this._drapeRenderer.removeGeometries(this._renderGeometries,2),this._drapeRenderer.commitChanges(),this._renderGeometries.length=0),this.attached&&this._view.overlayManager.unregisterDrapeSource(this),this._drapeRenderer=(0,s.pR)(this._drapeRenderer)}}var j=i(37046),N=i(8918);class z extends G{constructor(e,t,i,n,r){super(e,t,i,n,E.Fq.LINE_ROUND.bytesPerFeature),this._view=r,this._objects3D=[],this._engineLayer=null,this._frameTask=null}get attached(){return null!=this._engineLayer}async attach(){const{geometries:e}=this;null!=e&&(this.detach(),this._frameTask=this._view.resourceController.scheduler.registerTask(U.W6.FLOW_GENERATOR),await this._frameTask.scheduleGenerator((t=>this._addGeometryToLayer(e,t))))}detach(){var e,t;this.attached&&(null!==(e=this._engineLayer)&&void 0!==e&&e.removeMany(this._objects3D),this._objects3D.forEach((e=>e.dispose())),null!==(t=this._engineLayer)&&void 0!==t&&t.commit(),this._objects3D=[],this._engineLayer=null,this._frameTask=(0,s.xt)(this._frameTask))}_addGeometryToLayer(e,t){var i=this;return(0,Z.A)((function*(){const{stage:n}=i._view,r=new N.x(n,{pickable:!1,updatePolicy:1});for(let a=0;a<e.length;a+=M.ti){const n=new j.B({geometries:e.slice(a,a+M.ti),castShadow:!1});r.add(n),i._objects3D.push(n),r.commit(),t.madeProgress(),t.done&&(t=yield)}i._engineLayer=r}))()}}var H=i(9902),K=i(12028),$=i(52479),Q=i(90992);let Y=class extends w.A{constructor(e){super(e),this.type="flow",this.renderedTiles=null,this.requireLoad=!1,this.workerHandle=null,this.frameTask=null,this._averageLoadingTime=(0,d.Kp)(0),this._abortController=null,this._loadingState="ready-to-load",this._tilesUpdateIsWaiting=!1,this._debugAllowAutoLoading=!0,this.emissiveStrength=0,this._overrideMaterialParameters=null,this._overrideSimulationSettings=null,this._overrideTransitionEnabled=null,this._updateTask=null,this._debouncedTileUpdate=(0,o.sg)((async()=>{const{allTiles:e}=this.surface,t=this._getTileFilterFunction(),i=new Set;await this.frameTask.scheduleGenerator((function*(n){for(let r=0;r<e.length;++r){const a=e.at(r);t(a)&&i.add(a),n.madeProgress(),n.done&&(n=yield)}})),this.renderedTiles=i}))}initialize(){const{surface:e,view:t}=this,{resourceController:i}=t;this.workerHandle=new b((0,T.m)(i)),this.frameTask=i.scheduler.registerTask(U.W6.FLOW_GENERATOR),this._updateTask=(0,u.mg)({update:e=>this._update(e)}),this.addHandles([(0,l.wB)((()=>this._simulationSettings),(()=>this.triggerLoad()),{sync:!0,equals:(e,t)=>null==e&&null==t||null!=e&&null!=t&&(0,_.r$)(e,t)}),(0,l.wB)((()=>{const{elevationInfo:e}=this;return[this._clippingArea,this._visible,this._draped,this.view.state.contentPixelRatio,this.view.viewingMode,null===e||void 0===e?void 0:e.mode,null===e||void 0===e?void 0:e.offset,null===e||void 0===e?void 0:e.unit,this._effectiveDensity]}),(()=>this.triggerLoad()),l.OH),(0,l.wB)((()=>this._materialParameters),(e=>{var t,i;null!==(t=this._resources)&&void 0!==t&&t.setMaterialParameters(e),null===(i=this._lastResources)||void 0===i||i.setMaterialParameters(e)})),e.on("tiles-changed",(()=>{this.loadByTileTreesAllowed&&this._triggerTilesUpdate()})),t.enableFeatureTiles(),(0,l.wB)((()=>[this._dataBounds,this._featureTilesBounds,this.loadAllTiles]),(()=>this._triggerTilesUpdate())),(0,l.wB)((()=>this._flowRenderer),((e,t)=>{var i,n;const r=null!==(i=null===t||void 0===t?void 0:t.visualVariables)&&void 0!==i?i:[],a=null!==(n=null===e||void 0===e?void 0:e.visualVariables)&&void 0!==n?n:[];a.length===r.length&&a.every(((e,t)=>e.type===r[t].type))||this.clear()})),(0,l.z7)((()=>{var e;return!(null!==(e=t.featureTiles)&&void 0!==e&&e.updating)}),(()=>{this.loadByTileTreesAllowed&&this._triggerTilesUpdate()}))]),this._triggerTilesUpdate()}destroy(){this._updateTask=(0,s.xt)(this._updateTask),this.abort(),this.clear()}abort(){this._abortController=(0,s.DC)(this._abortController),this.requireLoad=!1}get _clippingArea(){const e=(0,m.projectOrLoad)(this.view.clippingArea,this.surface.spatialReference).geometry;return null==e?null:(0,p.VY)(e)}get _dataBounds(){const e=(0,m.projectOrLoad)(this.layer.fullExtent,this.surface.spatialReference).geometry;return null==e?null:(0,p.VY)(e)}get _draped(){return"on-the-ground"===this.elevationInfo.mode}get _ellipsoidRadius(){return(0,g.tO)(this.view.spatialReference).radius}get extent(){const{spatialReference:e}=this.surface;let t=this.renderedTiles;if(null==e||null==t)return null;const i=this.view.terrainLevel;if(null!=i){const e=new Set;t.forEach((t=>{Math.abs(i-t.level)<M.iM&&e.add(t)})),t=e}const n=(0,I.DW)(t,this.spatialReferenceInfo);return null==n?null:((0,p.E$)(n,this._clippingArea,n),(0,p.w1)(n,e))}get loadAllTiles(){const{position:e}=this.view.camera,t=e.z;return null!=t&&t*(0,c.G9)(e.spatialReference)/this._ellipsoidRadius>=M.FO}get isDataGlobal(){const{extent:e,spatialReferenceInfo:t}=this;return null!=e&&(0,x.iE)(e.xmin,e.xmax,t)}get loadByTileTreesAllowed(){return!this.loadAllTiles||!this.loadRequirementsMet}get _featureTilesBounds(){var e;const t=null===(e=this.view.featureTiles)||void 0===e?void 0:e.filterExtent,i=(0,m.projectOrLoad)(t,this.surface.spatialReference).geometry;return null==i?null:(0,p.VY)(i)}get _flowRenderer(){const e=this.layer.renderer;return"flow"!==(null===e||void 0===e?void 0:e.type)?null:e}get _materialParameters(){return(0,n.A)((0,n.A)((0,n.A)({},function(e,t,i){var n,r,a,s;if(null==e)return{};let o=null;if(e.visualVariables){const t=[],i=e.visualVariables,n=new k.wI({supports:{size:!0,color:!0,rotation:!1,opacity:!0}});o=(0,k.T3)(i,n,t)}const l=null!==(n=o)&&void 0!==n&&n.color?[1,1,1,1]:A.A.toUnitRGBA(e.color);return l[3]*=t,{color:l,width:e.trailWidth,cap:0,animationSpeed:e.flowSpeed,trailLength:e.trailLength,animation:3,emissiveStrength:i,vvColor:null===(r=o)||void 0===r?void 0:r.color,vvOpacity:null===(a=o)||void 0===a?void 0:a.opacity,vvSize:null===(s=o)||void 0===s?void 0:s.size}}(this._flowRenderer,this.layerView.fullOpacity,this.emissiveStrength)),{},{fadeInTime:M.jt,fadeOutTime:M.um},this._overrideMaterialParameters),{},{hasSlicePlane:this.layerView.slicePlaneEnabled,screenSizePerspective:!this._draped&&(0,K.tl)(this.layer.screenSizePerspectiveEnabled)?this.view.screenSizePerspective.parameters:null})}get _opacity(){return this.layerView.fullOpacity}get _seamlessTransitionWaitingTime(){const{_averageLoadingTime:e}=this;return(0,d.Kp)(0===e?M.$7:this._averageLoadingTime*M.nD)}get _seamlessTransitionEnabled(){return null!=this._overrideTransitionEnabled?this._overrideTransitionEnabled:M.q7}get _tracingResolution(){var e;const{extent:t}=this;if(!t)return[0,0];const i=(0,x.Wn)(t.xmin,t.xmax,null===(e=this.spatialReferenceInfo)||void 0===e?void 0:e.valid)/(t.ymax-t.ymin),[n,r]=this.view.size;let a,s;n<r?(a=n,s=n/i):(a=r*i,s=r);const o=M.NK,l=this.view.qualitySettings.flow3D.maxTracingResolution,u=Math.max(1,o/Math.min(a,s)),d=u*Math.min(1,l/Math.max(a*u,s*u));return[Math.round(a*d),Math.round(s*d)]}get _visible(){var e;const t=null===(e=this._flowRenderer)||void 0===e?void 0:e.color;return this.visibleAtCurrentScale&&this.layer.effectiveVisible&&this._opacity>0&&(null==t||t.a>0)}get _estimatedStreamlines(){const{extent:e,_simulationSettings:t,renderedTiles:i}=this;if(null==t||null==i)return 0;const n=this._tracingResolution[0]*this._tracingResolution[1]/t.lineSpacing**2*t.density,r=null==e?null:(0,p.VY)(e);if(null==r)return 0;let a=0;for(const l of i)(0,p.gR)(r,l.extent)&&(a+=(0,p.Wc)(l.extent));const s=(0,p.Wc)(r),o=0===s?0:a/s;return 2*Math.round(n*o)}get _effectiveDensity(){const{_estimatedStreamlines:e,_simulationSettings:t}=this,{qualitySettings:i,quality:n}=this.view;if(null==t)return 0;const r=i.flow3D.maxTotalNumberOfStreamlines,a=e>=r?r/e:1,s=t.density*a*n;return t.lineSpacing/Math.sqrt(s)<t.lineCollisionWidth?(t.lineSpacing/t.lineCollisionWidth)**2:s}get elevationInfo(){var e;return null!==(e=this.layer.elevationInfo)&&void 0!==e?e:J}startPositions(e){if(!this._seamlessTransitionEnabled)return[];const{_flowRenderer:t,_resources:i}=this;return null==t||null==i?[]:(0,_.Dt)(i.streamlines,i.query,e,t.flowSpeed)}get needsMagnitude(){var e,t;return null!==(e=null===(t=this._flowRenderer)||void 0===t?void 0:t.hasVisualVariables())&&void 0!==e&&e}get spatialReferenceInfo(){return(0,v.Vp)(this.surface.spatialReference)}get layer(){return this.layerView.layer}get loadingState(){return this._loadingState}get loadRequirementsMet(){return null!=this.renderedTiles&&this.renderedTiles.size>0}getUpdating(){return this.updatingHandles.updating||this.requireLoad||"before-transition"===this._loadingState}get updating(){return this.getUpdating()}get visibleAtCurrentScale(){return!(0,Q.j)()||(0,Q.E5)(this.layer.effectiveScaleRange,this.view.scale)}get _simulationSettings(){const{_flowRenderer:e,_overrideSimulationSettings:t}=this;if(null==e)return null;let i=(0,_.hq)(e);return i.segmentLength=i.lineCollisionWidth/2,i.onlyForwardTracing=!1,i.density*=M.Ci,this.loadAllTiles&&this.isDataGlobal&&(i.density*=M.Cq),null!=t&&(i=(0,n.A)((0,n.A)({},i),t)),i}getSimulationSettings(e){const{_simulationSettings:t,spatialReferenceInfo:i}=this;if(null==t)return null;const r="global"===this.view.viewingMode&&null!=i&&(0,x.iE)(e.extent.xmin,e.extent.xmax,i);return(0,n.A)((0,n.A)({},t),{},{wrapAround:r,density:this._effectiveDensity})}get surface(){return this.view.basemapTerrain}doRefresh(){this.triggerLoad()}clear(){var e,t;null!==(e=this._resources)&&void 0!==e&&e.detach(),this._resources=null,null!==(t=this._lastResources)&&void 0!==t&&t.detach(),this._lastResources=null,this._loadingState="ready-to-load"}_update(e){var t;const i=(0,d.y)(e.time);(null===(t=this._lastResources)||void 0===t?void 0:t.hasFadedOut(i))&&this._lastResources.detach();const n=this._nextStateForTransition(i);if(!this.requireLoad||this.updatingHandles.updating||"ready-to-load"!==n||!this.loadRequirementsMet)return void(this._loadingState=n);this._loadingState="loading";this.updatingHandles.addPromise((0,o.QZ)((async()=>{const e=performance.now(),t=this._seamlessTransitionEnabled&&null!=this._resources?(0,d.Kp)(i+this._seamlessTransitionWaitingTime):i;await this._load(t);const n=(0,d.Kp)((performance.now()-e)/1e3);this._updateAverageLoadingTime(n)})())),this.requireLoad=!1}_updateAverageLoadingTime(e){const t=M.S$;this._averageLoadingTime=(0,d.Kp)(t*e+(1-t)*this._averageLoadingTime)}triggerLoad(){this._debugAllowAutoLoading&&(this.requireLoad=!0)}async _load(e){const{extent:t,view:i}=this;if(!this._visible)return this.clear(),void(this._loadingState="ready-to-load");if(null==t)return void(this._loadingState="ready-to-load");const n=new x.y6(t,this.layerView.timeExtent,this._tracingResolution,i.state.contentPixelRatio,e);null==this._abortController&&(this._abortController=new AbortController);const r=this._abortController,a=await this._loadStreamlines(n,r.signal);if((0,o.Te)(r.signal),this._visible&&null!=a){var s;null!==(s=this._lastResources)&&void 0!==s&&s.detach(),this._lastResources=this._resources,this._resources=a;const t=performance.now()/1e3,i=t>e?t:e;null!=this._lastResources&&(this._lastResources.endTime=i),this._resources.startTime=i,await a.attach(),this._loadingState=this._seamlessTransitionEnabled?"before-transition":"transitioning"}else this._loadingState="ready-to-load"}async _loadStreamlines(e,t){const i=await this.fetchDataAndGenerateStreamlines(e,t);if(null==i)return null;const{geometries:n,material:r}=await this._createGeometry(e,i);return this._draped?new B(e,i,r,n,this.layerView):new z(e,i,r,n,this.view)}async fetchDataAndGenerateStreamlines(e,t){return null}async _createGeometry(e,t){const i=new $.W(this._materialParameters,this.view.state.isGlobal),n=new Array,{elevationInfo:r,_draped:a,view:s}=this;return await this.frameTask.scheduleGenerator((function*(o){for(let l=0;l<t.length;++l)n.push(F(s,e,t[l],r,i,a)),o.madeProgress(),o.done&&(o=yield)})),{geometries:n,material:i}}_triggerTilesUpdate(){if(this._tilesUpdateIsWaiting)return;this._tilesUpdateIsWaiting=!0;this.updatingHandles.addPromise((0,o.QZ)((async()=>{await(0,l.C_)((()=>this.view.stationary)),this._tilesUpdateIsWaiting=!1,await this._debouncedTileUpdate()})()))}_getTileFilterFunction(){const{_dataBounds:e,view:t,_featureTilesBounds:i}=this;if(this.loadAllTiles)return t=>t.leaf&&X(e,t.extent);const n=t=>t.rendered&&t.visible&&X(e,t.extent),{featureTiles:r}=t;if(!r)return n;const s=r.tiles.filter((e=>e.measures.visible));return e=>n(e)&&X(i,e.extent)&&s.some((t=>{let{lij:i}=t;return(0,a.aI)(i,e.lij)||(0,H.ZH)(i,e.lij)}))}_nextStateForTransition(e){const{_resources:t}=this;if(null==this._flowRenderer||null==t||"ready-to-load"===this._loadingState||"loading"===this._loadingState)return this._loadingState;const i=t.startTime;return e<i?"before-transition":e<i+M.um?"transitioning":"ready-to-load"}get usedMemory(){var e,t,i,n;return(null!==(e=null===(t=this._lastResources)||void 0===t?void 0:t.usedMemory)&&void 0!==e?e:0)+(null!==(i=null===(n=this._resources)||void 0===n?void 0:n.usedMemory)&&void 0!==i?i:0)}get test(){}};(0,r.Cg)([(0,h.MZ)()],Y.prototype,"type",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"renderedTiles",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_resources",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_lastResources",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"requireLoad",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_averageLoadingTime",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_loadingState",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"emissiveStrength",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_clippingArea",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_dataBounds",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_draped",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_ellipsoidRadius",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"extent",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"loadAllTiles",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"isDataGlobal",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_featureTilesBounds",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_flowRenderer",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_materialParameters",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_opacity",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_seamlessTransitionWaitingTime",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_seamlessTransitionEnabled",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_tracingResolution",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_visible",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_estimatedStreamlines",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_effectiveDensity",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"elevationInfo",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"needsMagnitude",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"spatialReferenceInfo",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"layer",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"loadingState",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"updating",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"visibleAtCurrentScale",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_overrideMaterialParameters",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_overrideSimulationSettings",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_overrideTransitionEnabled",void 0),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"_simulationSettings",null),(0,r.Cg)([(0,h.MZ)()],Y.prototype,"surface",null),Y=(0,r.Cg)([(0,f.$)("esri.views.3d.layers.FlowSubView3D")],Y);const J=new y.A({mode:"on-the-ground"});function X(e,t){return null==e||null==t||(0,p.HY)(e,t)}}}]);
//# sourceMappingURL=33956.ea8d2c9f.chunk.js.map